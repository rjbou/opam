N0REP0
### OPAMYES=1
### <pkg:foo.1>
opam-version: "2.0"
build: [ "touch" "foo" ]
install: [ "cp" "foo" "%{lib}%/" ]
### <pkg:bar.1>
opam-version: "2.0"
build: [ "touch" "bar" ]
install: [ "cp" "bar" "%{lib}%/" ]
### <pre.sh>
rm -rf previous
cp -R OPAM previous
### <post.sh>
diff -r previous OPAM
### :I: switch creation :
### sh pre.sh
### opam switch create dr --dry-run foo

<><> Installing new switch packages <><><><><><><><><><><><><><><><><><><><><><>
Switch invariant: ["foo"]

<><> Processing actions <><><><><><><><><><><><><><><><><><><><><><><><><><><><>
Installing foo.1.
-> installed foo.1
Done.
### sh post.sh
Only in OPAM: dr
# Return code 1 #
### :II: package installation :
### rm -r OPAM/dr
### opam switch create dr foo

<><> Installing new switch packages <><><><><><><><><><><><><><><><><><><><><><>
Switch invariant: ["foo"]

<><> Processing actions <><><><><><><><><><><><><><><><><><><><><><><><><><><><>
-> installed foo.1
Done.
### sh pre.sh
### opam install bar --dry-run
The following actions will be simulated:
=== install 1 package
  - install bar 1

<><> Processing actions <><><><><><><><><><><><><><><><><><><><><><><><><><><><>
Installing bar.1.
-> installed bar.1
Done.
### sh post.sh
Only in OPAM/dr/.opam-switch: backup
Only in OPAM/dr/.opam-switch/build: bar.1
Binary files previous/dr/.opam-switch/packages/cache and OPAM/dr/.opam-switch/packages/cache differ
# Return code 1 #
### :III: package removal :
### opam install bar
The following actions will be performed:
=== install 1 package
  - install bar 1

<><> Processing actions <><><><><><><><><><><><><><><><><><><><><><><><><><><><>
-> installed bar.1
Done.
### sh pre.sh
### opam remove bar --dry-run
The following actions will be simulated:
=== remove 1 package
  - remove bar 1

<><> Processing actions <><><><><><><><><><><><><><><><><><><><><><><><><><><><>
-> removed   bar.1
Done.
### sh post.sh
Only in previous/dr/.opam-switch/packages: bar.1
Only in previous/dr/.opam-switch/packages: cache
# Return code 1 #
### :IV: pinning :
### <pin:nip/nip.opam>
opam-version: "2.0"
### <nip/a-file>
tauto
### sh pre.sh
### opam pin ./nip --dry-run
Package nip does not exist, create as a NEW package? [y/n] y
nip is now pinned to file://${BASEDIR}/nip (version dev)

The following actions will be simulated:
=== install 1 package
  - install nip dev (pinned)

<><> Processing actions <><><><><><><><><><><><><><><><><><><><><><><><><><><><>
Installing nip.dev.
-> installed nip.dev
Done.
### sh post.sh
Only in OPAM/dr/.opam-switch/build: nip.dev
Only in OPAM/dr/.opam-switch: overlay
Only in OPAM/dr/.opam-switch/packages: bar.1
Only in OPAM/dr/.opam-switch/packages: cache
Only in OPAM/dr/.opam-switch: sources
# Return code 1 #
### :V: pin removal :
### opam pin ./nip
nip is now pinned to file://${BASEDIR}/nip (version dev)

The following actions will be performed:
=== install 1 package
  - install nip dev (pinned)

<><> Processing actions <><><><><><><><><><><><><><><><><><><><><><><><><><><><>
-> retrieved nip.dev  (no changes)
-> installed nip.dev
Done.
### sh pre.sh
### opam pin remove ./nip --dry-run
Ok, nip is no longer pinned to file://${BASEDIR}/nip (version dev)
The following actions will be simulated:
=== remove 1 package
  - remove nip dev

<><> Processing actions <><><><><><><><><><><><><><><><><><><><><><><><><><><><>
-> removed   nip.dev
Done.
### sh post.sh
Only in previous/dr/.opam-switch/overlay: nip
Only in previous/dr/.opam-switch/packages: cache
Only in previous/dr/.opam-switch/packages: nip.dev
Only in previous/dr/.opam-switch/sources: nip
# Return code 1 #
